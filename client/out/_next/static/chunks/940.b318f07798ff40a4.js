(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[940],{8423:function(e,t,n){"use strict";let r=n(8472).Z.create({baseURL:"http://localhost:5000",timeout:5e3,headers:{"Content-Type":"application/json"}});t.Z=r},6940:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return z}});var r,a,l,o,i,c,u=n(7437),s=n(2265);let d=(0,s.createContext)(null),f=d.Provider;function p(){let e=(0,s.useContext)(d);if(null==e)throw Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return e}var m=n(7691),h=n.n(m);function g(){return(g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}let x=(0,s.forwardRef)(function({bounds:e,boundsOptions:t,center:n,children:r,className:a,id:l,placeholder:o,style:i,whenReady:c,zoom:u,...d},p){let[h]=(0,s.useState)({className:a,id:l,style:i}),[x,b]=(0,s.useState)(null);(0,s.useImperativeHandle)(p,()=>x?.map??null,[x]);let y=(0,s.useCallback)(r=>{if(null!==r&&null===x){let a=new m.Map(r,d);null!=n&&null!=u?a.setView(n,u):null!=e&&a.fitBounds(e,t),null!=c&&a.whenReady(c),b(Object.freeze({__version:1,map:a}))}},[]);(0,s.useEffect)(()=>()=>{x?.map.remove()},[x]);let v=x?s.createElement(f,{value:x},r):o??null;return s.createElement("div",g({},h,{ref:y}),v)});var b=n(4887);function y(e,t,n){return Object.freeze({instance:e,context:t,container:n})}function v(e,t){return null==t?function(t,n){let r=(0,s.useRef)();return r.current||(r.current=e(t,n)),r}:function(n,r){let a=(0,s.useRef)();a.current||(a.current=e(n,r));let l=(0,s.useRef)(n),{instance:o}=a.current;return(0,s.useEffect)(function(){l.current!==n&&(t(o,n,l.current),l.current=n)},[o,n,r]),a}}function w(e,t){let n=(0,s.useRef)(t);(0,s.useEffect)(function(){t!==n.current&&null!=e.attributionControl&&(null!=n.current&&e.attributionControl.removeAttribution(n.current),null!=t&&e.attributionControl.addAttribution(t)),n.current=t},[e,t])}function j(e,t){let n=(0,s.useRef)();(0,s.useEffect)(function(){return null!=t&&e.instance.on(t),n.current=t,function(){null!=n.current&&e.instance.off(n.current),n.current=null}},[e,t])}function k(e,t){let n=e.pane??t.pane;return n?{...e,pane:n}:e}function C(e){return function(t){var n;let r=p(),a=e(k(t,r),r);return w(r.map,t.attribution),j(a.current,t.eventHandlers),n=a.current,(0,s.useEffect)(function(){return(r.layerContainer??r.map).addLayer(n.instance),function(){r.layerContainer?.removeLayer(n.instance),r.map.removeLayer(n.instance)}},[r,n]),a}}let N=(r=C(v(function({url:e,...t},n){return y(new m.TileLayer(e,k(t,n)),n)},function(e,t,n){!function(e,t,n){let{opacity:r,zIndex:a}=t;null!=r&&r!==n.opacity&&e.setOpacity(r),null!=a&&a!==n.zIndex&&e.setZIndex(a)}(e,t,n);let{url:r}=t;null!=r&&r!==n.url&&e.setUrl(r)})),(0,s.forwardRef)(function(e,t){let{instance:n}=r(e).current;return(0,s.useImperativeHandle)(t,()=>n),null})),I=(a=C(v(function({position:e,...t},n){var r;let a=new m.Marker(e,t);return y(a,(r={overlayContainer:a},Object.freeze({...n,...r})))},function(e,t,n){t.position!==n.position&&e.setLatLng(t.position),null!=t.icon&&t.icon!==n.icon&&e.setIcon(t.icon),null!=t.zIndexOffset&&t.zIndexOffset!==n.zIndexOffset&&e.setZIndexOffset(t.zIndexOffset),null!=t.opacity&&t.opacity!==n.opacity&&e.setOpacity(t.opacity),null!=e.dragging&&t.draggable!==n.draggable&&(!0===t.draggable?e.dragging.enable():e.dragging.disable())})),(0,s.forwardRef)(function(e,t){let{instance:n,context:r}=a(e).current;return(0,s.useImperativeHandle)(t,()=>n),null==e.children?null:s.createElement(f,{value:r},e.children)})),E=(l=function(e,t){return y(new m.Popup(e,t.overlayContainer),t)},o=function(e,t,{position:n},r){(0,s.useEffect)(function(){let{instance:a}=e;function l(e){e.popup===a&&(a.update(),r(!0))}function o(e){e.popup===a&&r(!1)}return t.map.on({popupopen:l,popupclose:o}),null==t.overlayContainer?(null!=n&&a.setLatLng(n),a.openOn(t.map)):t.overlayContainer.bindPopup(a),function(){t.map.off({popupopen:l,popupclose:o}),t.overlayContainer?.unbindPopup(),t.map.removeLayer(a)}},[e,t,r,n])},i=v(l),c=function(e,t){let n=p(),r=i(k(e,n),n);return w(n.map,e.attribution),j(r.current,e.eventHandlers),o(r.current,n,e,t),r},(0,s.forwardRef)(function(e,t){let[n,r]=(0,s.useState)(!1),{instance:a}=c(e,r).current;(0,s.useImperativeHandle)(t,()=>a),(0,s.useEffect)(function(){n&&a.update()},[a,n,e.children]);let l=a._contentNode;return l?(0,b.createPortal)(e.children,l):null}));n(966);var O=n(8423);n(3054);var L=e=>{let{totalMarkers:t}=e;return(0,u.jsx)("div",{children:(0,u.jsx)("a",{href:"#",className:"flex flex-col items-center bg-white border border-gray-200 rounded-xl shadow md:flex-row md:max-w-xs",children:(0,u.jsxs)("div",{className:"flex flex-row items-center",children:[(0,u.jsx)("div",{className:"px-3",children:(0,u.jsx)("img",{src:"/loc_icon.png",alt:"Location Icon"})}),(0,u.jsxs)("div",{className:"flex flex-col justify-between p-4 leading-normal",children:[(0,u.jsx)("p",{className:"mb-2 font-lg font-bold text-gray-700 dark:text-gray-400",children:"Total Pin Location"}),(0,u.jsx)("h5",{className:"mb-2 text-xl font-bold tracking-tight text-gray-800",children:t})]})]})})})},z=e=>{let{adminToken:t}=e,[n,r]=(0,s.useState)([]),[a,l]=(0,s.useState)(()=>{let e=localStorage.getItem("notifiedLocations");return new Set(e?JSON.parse(e):[])}),o=(0,s.useRef)(null);(0,s.useEffect)(()=>{delete h().Icon.Default.prototype._getIconUrl,h().Icon.Default.mergeOptions({iconRetinaUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon-2x.png",iconUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-icon.png",shadowUrl:"https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png"}),i()},[]),(0,s.useEffect)(()=>{if(localStorage.setItem("notifiedLocations",JSON.stringify([...a])),o.current&&o.current.invalidateSize(),n.length&&o.current){let e=n.map(e=>[parseFloat(e.latitude),parseFloat(e.longitude)]);o.current.fitBounds(e)}},[n,a]);let i=(0,s.useCallback)(async()=>{try{let e=await O.Z.get("/api/location-data",{headers:{Authorization:"Bearer ".concat(t)}});r(e.data)}catch(e){console.error("Error fetching data:",e)}},[t]),c=(0,s.useCallback)(async e=>{try{await O.Z.post("/api/send-help/".concat(e),{},{headers:{Authorization:"Bearer ".concat(t)}}),l(t=>new Set(t).add(e))}catch(e){console.error("Error sending help:",e)}},[t]),d=(0,s.useCallback)(async e=>{try{await O.Z.delete("/api/delete-marker/".concat(e),{headers:{Authorization:"Bearer ".concat(t)}}),r(t=>t.filter(t=>t.id!==e))}catch(e){console.error("Error deleting marker:",e)}},[t]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{className:"my-4 hidden md:block",children:(0,u.jsx)(L,{totalMarkers:n.length})}),(0,u.jsxs)(x,{center:[13.75,121.05],zoom:13,style:{height:"480px",width:"100%"},className:"map-container",whenCreated:e=>{o.current=e},children:[(0,u.jsx)(N,{url:"https://tiles.stadiamaps.com/tiles/outdoors/{z}/{x}/{y}{r}.png",attribution:'\xa9 <a href="https://stadiamaps.com/">Stadia Maps</a> contributors'}),n.map(e=>(0,u.jsx)(I,{position:[parseFloat(e.latitude),parseFloat(e.longitude)],children:(0,u.jsx)(E,{children:(0,u.jsxs)("div",{className:"text-center",children:[(0,u.jsx)("img",{src:"http://localhost:5000".concat(e.image),alt:"Popup Image",className:"w-full text-white mb-2 rounded-lg place-self-center"}),(0,u.jsxs)("p",{className:"text-white text-xs",children:["Location uploaded by ",e.userName]}),(0,u.jsx)("button",{onClick:()=>c(e.id),className:"".concat(a.has(e.id)?"bg-gray-500 cursor-not-allowed":"bg-red-700 hover:bg-red-800"," text-white font-bold py-2 px-3 rounded"),disabled:a.has(e.id),children:a.has(e.id)?"Help sent":"Send Help"}),a.has(e.id)&&(0,u.jsx)("button",{onClick:()=>d(e.id),className:"bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-4 rounded ml-3",children:"Delete Marker"})]})})},e.id))]})]})}},966:function(){},3054:function(){}}]);