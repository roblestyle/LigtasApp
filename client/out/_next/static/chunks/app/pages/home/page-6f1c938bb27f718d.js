(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{4409:function(e,t,s){Promise.resolve().then(s.bind(s,6070))},8423:function(e,t,s){"use strict";let r=s(8472).Z.create({baseURL:"https://steerhub.batstateu.edu.ph/ligtas-app-backend",timeout:3e4,headers:{"Content-Type":"application/json"}});t.Z=r},6070:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return j}});var r=s(7437),n=s(2265),a=s(1313),l=s.n(a),o=s(6820),i=s.n(o),c=s(8423),d=s(5127),u=s(4599),m=e=>{let{isOpen:t,setIsOpen:s}=e;return(0,n.useEffect)(()=>{if(t){let e=setTimeout(()=>{s(!1)},1400);return()=>clearTimeout(e)}},[t,s]),(0,r.jsx)(d.M,{children:t&&(0,r.jsx)(u.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.5,transition:{duration:.5}},onClick:()=>s(!1),className:"bg-slate-900/20 backdrop-blur p-8 fixed inset-0 z-50 flex justify-center items-center cursor-pointer",children:(0,r.jsxs)(u.E.div,{initial:{scale:0,rotate:"12.5deg",translateY:-20},animate:{scale:1,rotate:"0deg",translateY:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6 md:p-8 text-center relative overflow-hidden",style:{minHeight:"250px",maxHeight:"80vh"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",className:"text-green-400 w-16 h-16 mx-auto mt-4",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),(0,r.jsx)("h3",{className:"text-xl md:text-2xl font-semibold text-gray-600 mt-4 md:mt-6",children:"Successful"})]})})})};let x=["Pablo Borbon","Alangilan","ARASOF-Nasugbu","Balayan","Lemery","Mabini","JPLPC-Malvar","Lipa","Rosario","San Juan","Lobo"];var h=n.memo(e=>{let{user:t}=e,s=(0,n.useRef)(null),a=(0,n.useRef)(null),[o,d]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1),[p,f]=(0,n.useState)("user"),[g,w]=(0,n.useState)(null),[j,b]=(0,n.useState)(!1),[v,N]=(0,n.useState)(""),[y,k]=(0,n.useState)(""),[C,S]=(0,n.useState)(""),[E,L]=(0,n.useState)(x),[A,P]=(0,n.useState)(!1),I=async()=>{try{if(null===g){d("Please select your condition before proceeding.");return}if(0===g&&""===y.trim()){d("Please enter a contact number.");return}let e=new FormData;if(e.append("userId",t),e.append("condition",g),e.append("message",v),e.append("campus",C),0===g&&e.append("contactNumber",y),j&&s.current){let t=s.current.getScreenshot();if(t){let s=await fetch(t).then(e=>e.blob());e.append("image",s,"webcam-image.jpg")}else d("Failed to capture the webcam image.")}let r=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)});e.append("latitude",r.coords.latitude.toString()),e.append("longitude",r.coords.longitude.toString());let n=await c.Z.post("/api/upload",e,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}});console.log("Image and location uploaded successfully:",n.data),h(!0)}catch(e){console.error("Error capturing image or uploading location:",e),d("Error capturing image or uploading location.")}},T=e=>{S(e),L([]),P(!1)};return(0,n.useEffect)(()=>{let e=e=>{a.current&&!a.current.contains(e.target)&&P(!1)};return A?document.addEventListener("mousedown",e):document.removeEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[A]),(0,r.jsxs)("div",{className:"flex flex-col justify-center p-4 z-10",children:[(0,r.jsx)("h1",{className:"red-spartan-heading text-xl font-bold text-center mb-4",children:(0,r.jsx)("p",{className:l().className,children:"Mga Ka-Red Spartan, Ligtas ka ba? Kung hindi, send us your location!"})}),o&&(0,r.jsx)("p",{className:"p-4 font-bold text-red-900",children:o}),(0,r.jsxs)("div",{className:"flex justify-center space-x-4 mb-4",children:[(0,r.jsxs)("button",{onClick:()=>{w(1),d("")},className:"py-2 px-4 rounded-md text-white ".concat(1===g?"bg-green-700":"bg-green-500"," hover:bg-green-600"),children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"inline-block w-6 h-6 mr-1",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),"I am SAFE"]}),(0,r.jsxs)("button",{onClick:()=>{w(0),d("")},className:"py-2 px-4 rounded-md text-white ".concat(0===g?"bg-red-700":"bg-red-500"," hover:bg-red-600"),children:[(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"inline-block w-6 h-6 mr-1",children:[(0,r.jsx)("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",fontSize:"6",fill:"currentColor",children:"SOS"}),(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"})]}),"I Need Help"]})]}),(0,r.jsxs)("div",{className:"flex justify-center mb-4",children:[1===g&&(0,r.jsx)("p",{className:"text-green-400 font-bold",children:"You are SAFE!"}),0===g&&(0,r.jsx)("p",{className:"text-red-600 font-bold",children:"You need Help!"})]}),0===g&&(0,r.jsx)("div",{className:"flex flex-col justify-center items-center mb-4",children:(0,r.jsx)("input",{type:"text",value:y,onChange:e=>k(e.target.value),placeholder:"Please provide us your contact number",className:"p-2 border rounded-md w-96",required:!0})}),(0,r.jsxs)("div",{className:"flex flex-col justify-center items-center mb-4 relative",ref:a,children:[(0,r.jsx)("label",{className:"mb-2 font-semibold",children:"Affiliated Campus"}),(0,r.jsxs)("div",{className:"flex items-center w-96",children:[(0,r.jsx)("input",{type:"text",value:C,onChange:e=>{let t=e.target.value;S(t),L(x.filter(e=>e.toLowerCase().includes(t.toLowerCase()))),P(t.length>0)},placeholder:"Type or select your campus",className:"p-2 border rounded-l-md w-full"}),(0,r.jsx)("button",{onClick:()=>{P(!A)},className:"p-2 border rounded-r-md bg-gray-200",children:"â–¼"})]}),A&&(0,r.jsx)("ul",{className:"absolute top-full mt-1 w-96 max-h-48 overflow-y-auto bg-white border rounded-md shadow-lg z-20",children:E.map((e,t)=>(0,r.jsx)("li",{onClick:()=>T(e),className:"p-2 hover:bg-gray-200 cursor-pointer",children:e},t))})]}),(0,r.jsx)("div",{className:"flex flex-col justify-center items-center mb-4",children:(0,r.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),placeholder:"What happened? (optional)",className:"p-2 border rounded-md w-96"})}),(0,r.jsx)("div",{className:"flex justify-center mb-4",children:(0,r.jsx)("button",{onClick:()=>{b(e=>!e)},className:"bg-blue-800 text-white py-2 px-4 rounded-md hover:bg-blue-900",children:j?"Close Camera":"Open Camera"})}),j&&(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"rounded-lg h-auto w-auto flex items-center justify-center",children:(0,r.jsx)(i(),{audio:!1,ref:s,screenshotFormat:"image/jpeg",width:400,height:400,onUserMediaError:e=>{console.error("Error accessing webcam:",e),d("Error accessing webcam. Please check permissions or try again.")},className:"rounded-lg border",videoConstraints:{facingMode:p}})})}),j&&(0,r.jsx)("div",{className:"flex flex-col p-4",children:(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:()=>{f(e=>"user"===e?"environment":"user")},className:"bg-blue-800 text-white py-2 px-2 mt-2 rounded-md hover:bg-blue-900",children:"Switch Camera"})})}),(0,r.jsx)("div",{className:"flex flex-col p-4",children:(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:I,className:"bg-red-800 text-white py-2 px-2 mt-2 rounded-md hover:bg-red-900",children:"SEND"})})}),(0,r.jsx)(m,{isOpen:u,setIsOpen:h})]})}),p=function(){return(0,r.jsx)("div",{className:"h-screen w-screen overflow-hidden",children:(0,r.jsx)("img",{src:"".concat("/safespartan","/user_home.png"),className:"object-cover w-full h-full"})})};function f(e){let{profileImage:t,handleDeleteAccount:s}=e,[a,l]=(0,n.useState)(!1),o=(0,n.useRef)(null),i=e=>{o.current&&!o.current.contains(e.target)&&l(!1)};return(0,n.useEffect)(()=>(document.addEventListener("mousedown",i),()=>{document.removeEventListener("mousedown",i)}),[]),(0,r.jsxs)("div",{className:"relative",ref:o,children:[(0,r.jsx)("img",{src:t,alt:"Profile",className:"w-14 h-14 sm:w-14 sm:h-14 rounded-md cursor-pointer",onClick:()=>{l(!a)}}),a&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[(0,r.jsx)("button",{onClick:s,className:"block px-4 py-2 text-sm text-red-700 hover:bg-gray-100 w-full text-left",children:"Delete Account"}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("userToken"),window.location.href="".concat("/safespartan","/pages/login/")},className:"block px-4 py-2 text-sm text-blue-700 hover:bg-gray-100 w-full text-left",children:"Logout"})]})]})}function g(e){let{userId:t}=e,[s,a]=(0,n.useState)([]),[l,o]=(0,n.useState)(!1),[i,d]=(0,n.useState)([]),u=(0,n.useRef)(null),m=(0,n.useRef)(null),x=e=>"[".concat(e,"]"),h=e=>{!u.current||u.current.contains(e.target)||m.current&&m.current.contains(e.target)||o(!1)},p=e=>{i.includes(e)?d(t=>t.filter(t=>t!==e)):d(t=>[...t,e])},f=async()=>{try{let e=localStorage.getItem("userToken");await Promise.all(i.map(async t=>{await c.Z.delete("/api/notifications/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})})),a(e=>e.filter(e=>!i.includes(e.id))),d([])}catch(e){console.error("Error deleting marked notifications:",e)}},g=async()=>{try{let e=localStorage.getItem("userToken"),s=await c.Z.get("/api/notifications/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});a(s.data.notifications)}catch(e){console.error("Error fetching notifications:",e)}};return(0,n.useEffect)(()=>(document.addEventListener("mousedown",h),()=>{document.removeEventListener("mousedown",h)}),[]),(0,n.useEffect)(()=>{t&&g()},[t]),(0,n.useEffect)(()=>{let e=setInterval(()=>{t&&g()},3e3);return()=>clearInterval(e)},[t]),(0,r.jsxs)("div",{className:"relative mx-4",ref:u,children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7 text-white cursor-pointer",onClick:e=>{e.stopPropagation(),o(!l)},children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.25 9a6.75 6.75 0 0 1 13.5 0v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 0 1-.297 1.206c-1.544.57-3.16.99-4.831 1.243a3.75 3.75 0 1 1-7.48 0 24.585 24.585 0 0 1-4.831-1.244.75.75 0 0 1-.298-1.205A8.217 8.217 0 0 0 5.25 9.75V9Zm4.502 8.9a2.25 2.25 0 1 0 4.496 0 25.057 25.057 0 0 1-4.496 0Z",clipRule:"evenodd"})}),l&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg py-1 z-50",children:[s.length>0?s.map(e=>(0,r.jsxs)("div",{className:"px-4 py-2 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[i.includes(e.id)?(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-red-600 cursor-pointer",checked:!0,onChange:()=>p(e.id)}):(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-red-600 cursor-pointer",onChange:()=>p(e.id)}),(0,r.jsx)("p",{className:"text-sm ml-2",children:e.message})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:x(e.createdAt)})]},e.id)):(0,r.jsx)("div",{className:"px-4 py-2",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"There are no new notifications."})}),i.length>0&&(0,r.jsx)("div",{className:"px-4 py-2 flex justify-end",children:(0,r.jsx)("button",{ref:m,onClick:e=>{e.stopPropagation(),f()},className:"text-xs text-red-600 hover:text-red-800",children:"Delete Selected"})})]})]})}var w=s(9714);function j(){let e="/safespartan",[t,s]=(0,n.useState)(null),[a,l]=(0,n.useState)(null),[o,i]=(0,n.useState)(null),d=()=>{localStorage.removeItem("userToken"),window.location.href="".concat(e,"/pages/login/")},u=async()=>{try{let e=localStorage.getItem("userToken");await c.Z.delete("/api/".concat(a),{headers:{Authorization:e}}),d()}catch(e){console.error("Error deleting account:",e)}};(0,n.useEffect)(()=>{let e=localStorage.getItem("userToken");if(e||(e=new URLSearchParams(window.location.search).get("userToken")),e)try{let t=(0,w.o)(e);s(t.name),l(t.id),i(t.profile_image),localStorage.setItem("userToken",e)}catch(e){console.error("Error decoding token:",e),m()}else console.error("Token is missing"),m()},[]);let m=()=>{window.location.href="".concat(e,"/pages/login/")};return(0,r.jsxs)("div",{className:"relative h-screen w-screen",children:[(0,r.jsx)("div",{className:"fixed inset-0 z-0",children:(0,r.jsx)(p,{})}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 sm:p-10",children:[(0,r.jsxs)("h1",{className:"text-lg sm:text-xl text-white font-semibold",children:["Hello, ",t||"Guest"]}),(0,r.jsxs)("div",{className:"relative flex items-center",children:[(0,r.jsx)(g,{userId:a}),(0,r.jsx)(f,{profileImage:o||"/profilePic.png",handleDeleteAccount:u})]})]}),(0,r.jsx)("div",{className:"flex-grow flex items-center justify-center pb-2 sm:pb-7",children:(0,r.jsx)(h,{user:a})}),(0,r.jsx)("div",{className:"flex justify-end p-4",children:(0,r.jsxs)("button",{onClick:d,className:"flex items-center bg-white rounded-lg w-24 p-2 sm:w-32 sm:p-4 hover:bg-gray-100",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 sm:w-6 sm:h-6 text-red-800",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})}),(0,r.jsx)("p",{className:"text-sm sm:text-base font-semibold text-red-700 ml-2",children:"Log-out"})]})})]})]})}}},function(e){e.O(0,[726,472,378,971,23,744],function(){return e(e.s=4409)}),_N_E=e.O()}]);