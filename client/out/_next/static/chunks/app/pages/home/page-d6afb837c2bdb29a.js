(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[247],{4612:function(e,t,s){Promise.resolve().then(s.bind(s,6070))},8423:function(e,t,s){"use strict";let r=s(8472).Z.create({baseURL:"https://api-ligtas.parallaxed.ph",timeout:5e3,headers:{"Content-Type":"application/json"}});t.Z=r},6070:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return f}});var r=s(7437),n=s(2265),a=s(6820),o=s.n(a),i=s(8423),l=s(5127),c=s(4599),d=e=>{let{isOpen:t,setIsOpen:s}=e;return(0,n.useEffect)(()=>{if(t){let e=setTimeout(()=>{s(!1)},1400);return()=>clearTimeout(e)}},[t,s]),(0,r.jsx)(l.M,{children:t&&(0,r.jsx)(c.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0,scale:.5,transition:{duration:.5}},onClick:()=>s(!1),className:"bg-slate-900/20 backdrop-blur p-8 fixed inset-0 z-50 flex justify-center items-center cursor-pointer",children:(0,r.jsxs)(c.E.div,{initial:{scale:0,rotate:"12.5deg",translateY:-20},animate:{scale:1,rotate:"0deg",translateY:0},onClick:e=>e.stopPropagation(),className:"bg-white rounded-lg shadow-lg w-full max-w-md p-6 md:p-8 text-center relative overflow-hidden",style:{minHeight:"250px",maxHeight:"80vh"},children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",className:"text-green-400 w-16 h-16 mx-auto mt-4",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"})}),(0,r.jsx)("h3",{className:"text-xl md:text-2xl font-semibold text-gray-600 mt-4 md:mt-6",children:"Image and location uploaded successfully"})]})})})},u=n.memo(e=>{let{user:t}=e,s=(0,n.useRef)(null),[a,l]=(0,n.useState)(""),[c,u]=(0,n.useState)(!1),[m,h]=(0,n.useState)("user"),x=async()=>{try{if(!s.current){l("Webcam not available.");return}let e=s.current.getScreenshot(),r=await fetch(e).then(e=>e.blob()),n=new FormData;n.append("image",r,"webcam-image.jpg"),n.append("userId",t);let a=await new Promise((e,t)=>{navigator.geolocation.getCurrentPosition(e,t)});n.append("latitude",a.coords.latitude.toString()),n.append("longitude",a.coords.longitude.toString());let o=await i.Z.post("/api/upload",n,{headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(t)}});console.log("Image and location uploaded successfully:",o.data),u(!0)}catch(e){console.error("Error capturing image or uploading location:",e),l("Error capturing image or uploading location.")}};return(0,r.jsxs)("div",{className:"flex flex-col justify-center p-4 z-10",children:[a&&(0,r.jsx)("p",{className:"p-4 text-red-500",children:a}),(0,r.jsx)("div",{className:"flex items-center justify-center",children:(0,r.jsx)("div",{className:"rounded-lg h-auto w-auto flex items-center justify-center",children:(0,r.jsx)(o(),{audio:!1,ref:s,screenshotFormat:"image/jpeg",width:400,height:400,onUserMediaError:e=>{console.error("Error accessing webcam:",e),l("Error accessing webcam. Please check permissions or try again.")},className:"rounded-lg border",videoConstraints:{facingMode:m}})})}),(0,r.jsxs)("div",{className:"flex flex-col p-4",children:[(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:x,className:"bg-red-800 text-white py-2 px-2 mt-2 rounded-md hover:bg-red-900",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"size-10",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6.827 6.175A2.31 2.31 0 0 1 5.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 0 0-1.134-.175 2.31 2.31 0 0 1-1.64-1.055l-.822-1.316a2.192 2.192 0 0 0-1.736-1.039 48.774 48.774 0 0 0-5.232 0 2.192 2.192 0 0 0-1.736 1.039l-.821 1.316Z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 12.75a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0ZM18.75 10.5h.008v.008h-.008V10.5Z"})]})})}),(0,r.jsx)("p",{className:"flex justify-center text-white font-medium py-3",children:"Take a picture"}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{onClick:()=>{h(e=>"user"===e?"environment":"user")},className:"bg-blue-800 text-white py-2 px-2 mt-2 rounded-md hover:bg-blue-900",children:"Switch Camera"})})]}),(0,r.jsx)(d,{isOpen:c,setIsOpen:u})]})}),m=s(357),h=function(){let e=m.env.NEXT_PUBLIC_BASE_PATH||"";return(0,r.jsx)("div",{className:"h-screen w-screen overflow-hidden",children:(0,r.jsx)("img",{src:"".concat(e,"/user_home.png"),className:"object-cover w-full h-full"})})};function x(e){let{profileImage:t,handleDeleteAccount:s}=e,[a,o]=(0,n.useState)(!1),i=(0,n.useRef)(null),l=e=>{i.current&&!i.current.contains(e.target)&&o(!1)};return(0,n.useEffect)(()=>(document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}),[]),(0,r.jsxs)("div",{className:"relative",ref:i,children:[(0,r.jsx)("img",{src:t,alt:"Profile",className:"w-14 h-14 sm:w-14 sm:h-14 rounded-md cursor-pointer",onClick:()=>{o(!a)}}),a&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg py-1 z-50",children:[(0,r.jsx)("button",{onClick:s,className:"block px-4 py-2 text-sm text-red-700 hover:bg-gray-100 w-full text-left",children:"Delete Account"}),(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("userToken"),window.location.href="/pages/login/"},className:"block px-4 py-2 text-sm text-blue-700 hover:bg-gray-100 w-full text-left",children:"Logout"})]})]})}function p(e){let{userId:t}=e,[s,a]=(0,n.useState)([]),[o,l]=(0,n.useState)(!1),[c,d]=(0,n.useState)([]),u=(0,n.useRef)(null),m=(0,n.useRef)(null),h=e=>"[".concat(e,"]"),x=e=>{!u.current||u.current.contains(e.target)||m.current&&m.current.contains(e.target)||l(!1)},p=e=>{c.includes(e)?d(t=>t.filter(t=>t!==e)):d(t=>[...t,e])},g=async()=>{try{let e=localStorage.getItem("userToken");await Promise.all(c.map(async t=>{await i.Z.delete("/api/notifications/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}})})),a(e=>e.filter(e=>!c.includes(e.id))),d([])}catch(e){console.error("Error deleting marked notifications:",e)}},f=async()=>{try{let e=localStorage.getItem("userToken"),s=await i.Z.get("/api/notifications/".concat(t),{headers:{Authorization:"Bearer ".concat(e)}});a(s.data.notifications)}catch(e){console.error("Error fetching notifications:",e)}};return(0,n.useEffect)(()=>(document.addEventListener("mousedown",x),()=>{document.removeEventListener("mousedown",x)}),[]),(0,n.useEffect)(()=>{t&&f()},[t]),(0,n.useEffect)(()=>{let e=setInterval(()=>{t&&f()},3e3);return()=>clearInterval(e)},[t]),(0,r.jsxs)("div",{className:"relative mx-4",ref:u,children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"w-7 h-7 text-white cursor-pointer",onClick:e=>{e.stopPropagation(),l(!o)},children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M5.25 9a6.75 6.75 0 0 1 13.5 0v.75c0 2.123.8 4.057 2.118 5.52a.75.75 0 0 1-.297 1.206c-1.544.57-3.16.99-4.831 1.243a3.75 3.75 0 1 1-7.48 0 24.585 24.585 0 0 1-4.831-1.244.75.75 0 0 1-.298-1.205A8.217 8.217 0 0 0 5.25 9.75V9Zm4.502 8.9a2.25 2.25 0 1 0 4.496 0 25.057 25.057 0 0 1-4.496 0Z",clipRule:"evenodd"})}),o&&(0,r.jsxs)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg py-1 z-50",children:[s.length>0?s.map(e=>(0,r.jsxs)("div",{className:"px-4 py-2 flex justify-between items-center",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[c.includes(e.id)?(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-red-600 cursor-pointer",checked:!0,onChange:()=>p(e.id)}):(0,r.jsx)("input",{type:"checkbox",className:"form-checkbox h-4 w-4 text-red-600 cursor-pointer",onChange:()=>p(e.id)}),(0,r.jsx)("p",{className:"text-sm ml-2",children:e.message})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:h(e.createdAt)})]},e.id)):(0,r.jsx)("div",{className:"px-4 py-2",children:(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"There are no new notifications."})}),c.length>0&&(0,r.jsx)("div",{className:"px-4 py-2 flex justify-end",children:(0,r.jsx)("button",{ref:m,onClick:e=>{e.stopPropagation(),g()},className:"text-xs text-red-600 hover:text-red-800",children:"Delete Selected"})})]})]})}var g=s(9714);function f(){let[e,t]=(0,n.useState)(null),[s,a]=(0,n.useState)(null),[o,l]=(0,n.useState)(null),c=()=>{localStorage.removeItem("userToken"),window.location.href="/pages/login/"},d=async()=>{try{let e=localStorage.getItem("userToken");await i.Z.delete("/api/".concat(s),{headers:{Authorization:e}}),c()}catch(e){console.error("Error deleting account:",e)}};(0,n.useEffect)(()=>{let e=localStorage.getItem("userToken");if(e||(e=new URLSearchParams(window.location.search).get("userToken")),e)try{let s=(0,g.o)(e);t(s.name),a(s.id),l(s.profile_image),localStorage.setItem("userToken",e)}catch(e){console.error("Error decoding token:",e),m()}else console.error("Token is missing"),m()},[]);let m=()=>{window.location.href="/pages/login/"};return(0,r.jsxs)("div",{className:"relative h-screen w-screen overflow-hidden",children:[(0,r.jsx)("div",{className:"fixed inset-0 z-0",children:(0,r.jsx)(h,{})}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-full justify-between",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center p-4 sm:p-10",children:[(0,r.jsxs)("h1",{className:"text-lg sm:text-xl text-white font-semibold",children:["Hello, ",e||"Guest"]}),(0,r.jsxs)("div",{className:"relative flex items-center",children:[(0,r.jsx)(p,{userId:s}),(0,r.jsx)(x,{profileImage:o||"/profilePic.png",handleDeleteAccount:d})]})]}),(0,r.jsx)("div",{className:"flex-grow flex items-center justify-center pb-2 sm:pb-7",children:(0,r.jsx)(u,{user:s})}),(0,r.jsx)("div",{className:"flex justify-end p-4",children:(0,r.jsxs)("button",{onClick:c,className:"flex items-center bg-white rounded-lg w-24 p-2 sm:w-32 sm:p-4 hover:bg-gray-100",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-4 h-4 sm:w-6 sm:h-6 text-red-800",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"})}),(0,r.jsx)("p",{className:"text-sm sm:text-base font-semibold text-red-700 ml-2",children:"Log-out"})]})})]})]})}}},function(e){e.O(0,[472,285,971,23,744],function(){return e(e.s=4612)}),_N_E=e.O()}]);